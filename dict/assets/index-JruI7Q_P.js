(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class m{constructor(){this.fingerTips=[8,12,16,20],this.fingerBases=[5,9,13,17],this.fingerMids=[6,10,14,18],this.thumbTip=4,this.thumbBase=2,this.thumbMid=3,this.extendedThreshold=.05,this.thumbExtendedThreshold=.08}isFingerExtended(t,e,s,i){const n=t[e],r=t[s],h=t[i],a=Math.sqrt(Math.pow(n.x-r.x,2)+Math.pow(n.y-r.y,2)),c=Math.sqrt(Math.pow(h.x-r.x,2)+Math.pow(h.y-r.y,2));return n.y<r.y-this.extendedThreshold&&a>c}isThumbExtended(t){const e=t[this.thumbTip],s=t[this.thumbBase];t[this.thumbMid];const i=t[0],n=Math.abs(e.x-s.x),r=Math.abs(e.y-i.y);return n>this.thumbExtendedThreshold&&r<.3}countExtendedFingers(t){let e=0;this.isThumbExtended(t)&&e++;for(let s=0;s<this.fingerTips.length;s++)this.isFingerExtended(t,this.fingerTips[s],this.fingerBases[s],this.fingerMids[s])&&e++;return e}getPinchDistance(t){const e=t[this.thumbTip],s=t[8],i=t[this.thumbBase],n=t[5],r=e.x-s.x,h=e.y-s.y,a=(e.z||0)-(s.z||0),c=Math.sqrt(r*r+h*h+a*a),u=Math.sqrt(Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)),o=c/(u||1);return{isPinching:o<.3,distance:c,normalizedDistance:o}}getHandHeight(t){return 1-t[0].y}detectShape(t){const e=this.countExtendedFingers(t),s=this.getPinchDistance(t);if(e===5&&!s.isPinching)return"circle";if(e===0||e===1&&this.isThumbExtended(t))return"square";if(e===2){const i=this.isFingerExtended(t,8,5,6),n=this.isFingerExtended(t,12,9,10);if(i&&n)return"triangle"}else if(e===3)return"triangle";return null}getHandCenter(t){const e=t[0],s=t[9],i=t[5],n=t[13],r=(e.x+s.x+i.x+n.x)/4,h=(e.y+s.y+i.y+n.y)/4;return{x:r,y:h}}calculateSize(t){const h=(Math.max(.02,Math.min(.4,t))-.02)/(.4-.02);return 30+h*h*320}calculateColor(t){return`hsl(${Math.floor(t*360)}, 70%, 50%)`}getHandConfidence(t){let e=0;return t.forEach(s=>{s.visibility!==void 0&&s.visibility>.5&&e++}),e/t.length}}class p{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.currentShapes=[]}setCanvasSize(t,e){this.canvas.width=t,this.canvas.height=e}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentShapes=[]}drawCircle(t,e,s,i){this.ctx.beginPath(),this.ctx.arc(t,e,s/2,0,Math.PI*2),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.stroke()}drawSquare(t,e,s,i){this.ctx.fillStyle=i,this.ctx.fillRect(t-s/2,e-s/2,s,s),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.strokeRect(t-s/2,e-s/2,s,s)}drawTriangle(t,e,s,i){const n=s*Math.sqrt(3)/2;this.ctx.beginPath(),this.ctx.moveTo(t,e-n/2),this.ctx.lineTo(t-s/2,e+n/2),this.ctx.lineTo(t+s/2,e+n/2),this.ctx.closePath(),this.ctx.fillStyle=i,this.ctx.fill(),this.ctx.strokeStyle="white",this.ctx.lineWidth=3,this.ctx.stroke()}drawShape(t,e,s,i,n){switch(t){case"circle":this.drawCircle(e,s,i,n);break;case"square":this.drawSquare(e,s,i,n);break;case"triangle":this.drawTriangle(e,s,i,n);break}}drawHandLandmarks(t,e,s){const i=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]];this.ctx.strokeStyle="rgba(0, 255, 0, 0.5)",this.ctx.lineWidth=2,i.forEach(([n,r])=>{this.ctx.beginPath(),this.ctx.moveTo(t[n].x*e,t[n].y*s),this.ctx.lineTo(t[r].x*e,t[r].y*s),this.ctx.stroke()}),t.forEach((n,r)=>{const h=n.x*e,a=n.y*s;this.ctx.beginPath(),this.ctx.arc(h,a,5,0,Math.PI*2),this.ctx.fillStyle=r===4||r===8?"red":"lime",this.ctx.fill()})}addTrail(t,e,s,i,n){this.currentShapes.push({shape:t,x:e,y:s,size:i,color:n,alpha:1}),this.currentShapes.length>10&&this.currentShapes.shift()}drawTrail(){this.currentShapes.forEach((t,e)=>{const s=(e+1)/this.currentShapes.length*.5;this.ctx.globalAlpha=s,this.drawShape(t.shape,t.x,t.y,t.size,t.color)}),this.ctx.globalAlpha=1}}class x{constructor(){this.videoElement=document.getElementById("videoElement"),this.canvas=document.getElementById("canvas"),this.startButton=document.getElementById("startButton"),this.clearButton=document.getElementById("clearButton"),this.loadingOverlay=document.getElementById("loadingOverlay"),this.gestureRecognizer=new m,this.shapeRenderer=new p(this.canvas),this.hands=null,this.camera=null,this.isRunning=!1,this.currentShape=null,this.currentSize=100,this.currentColor="hsl(180, 70%, 50%)",this.shapeHistory=[],this.sizeHistory=[],this.colorHistory=[],this.historySize=5,this.setupEventListeners()}setupEventListeners(){this.startButton.addEventListener("click",()=>this.startCamera()),this.clearButton.addEventListener("click",()=>this.clearCanvas())}async startCamera(){try{this.startButton.disabled=!0,this.updateStatus("cameraStatus","Initializing..."),this.hands=new Hands({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${e}`}),this.hands.setOptions({maxNumHands:1,modelComplexity:1,minDetectionConfidence:.7,minTrackingConfidence:.7,selfieMode:!1}),this.hands.onResults(e=>this.onResults(e));const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}}});this.videoElement.srcObject=t,await new Promise(e=>{this.videoElement.onloadedmetadata=()=>{e()}}),this.shapeRenderer.setCanvasSize(this.videoElement.videoWidth,this.videoElement.videoHeight),this.camera=new Camera(this.videoElement,{onFrame:async()=>{this.isRunning&&await this.hands.send({image:this.videoElement})},width:1920,height:1080}),await this.camera.start(),this.isRunning=!0,this.loadingOverlay.classList.add("hidden"),this.updateStatus("cameraStatus","Active (Enhanced)"),this.startButton.textContent="Camera Running"}catch(t){console.error("Error starting camera:",t),alert("Failed to start camera. Please ensure camera permissions are granted."),this.startButton.disabled=!1,this.updateStatus("cameraStatus","Error")}}smoothValue(t,e,s){return t.push(e),t.length>s&&t.shift(),t.reduce((i,n)=>i+n,0)/t.length}getMostCommonShape(t,e,s){t.push(e),t.length>s&&t.shift();const i={};t.forEach(h=>{i[h]=(i[h]||0)+1});let n=0,r=e;for(const[h,a]of Object.entries(i))a>n&&(n=a,r=h);return r}onResults(t){const e=this.canvas.width,s=this.canvas.height;if(this.shapeRenderer.clear(),t.multiHandLandmarks&&t.multiHandLandmarks.length>0){const i=t.multiHandLandmarks[0];this.updateStatus("handStatus","Yes (Strong Signal)"),this.shapeRenderer.drawHandLandmarks(i,e,s);const n=this.gestureRecognizer.detectShape(i);if(n){this.currentShape=this.getMostCommonShape(this.shapeHistory,n,this.historySize),this.updateStatus("shapeStatus",this.currentShape.charAt(0).toUpperCase()+this.currentShape.slice(1));const r=this.gestureRecognizer.getPinchDistance(i),h=this.gestureRecognizer.calculateSize(r.distance);this.currentSize=this.smoothValue(this.sizeHistory,h,this.historySize),this.updateStatus("sizeStatus",Math.round(this.currentSize));const c=this.gestureRecognizer.getHandHeight(i)*360,u=this.smoothValue(this.colorHistory,c,this.historySize);this.currentColor=`hsl(${Math.floor(u)}, 70%, 50%)`;const o=this.gestureRecognizer.getHandCenter(i),l=o.x*e,g=o.y*s;this.shapeRenderer.drawShape(this.currentShape,l,g,this.currentSize,this.currentColor),this.shapeRenderer.addTrail(this.currentShape,l,g,this.currentSize,this.currentColor)}else this.updateStatus("shapeStatus","Gesture not recognized");this.shapeRenderer.drawTrail()}else this.updateStatus("handStatus","No"),this.updateStatus("shapeStatus","None"),this.shapeHistory=[],this.sizeHistory=[],this.colorHistory=[]}clearCanvas(){this.shapeRenderer.clear()}updateStatus(t,e){const s=document.getElementById(t);s&&(s.textContent=e)}}document.addEventListener("DOMContentLoaded",()=>{new x});